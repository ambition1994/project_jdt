!function(a){"function"==typeof define&&define.amd?define("bxcomboboxtree",["bxtree"],function(){a(window.jQuery)}):a(window.jQuery)}(function(a){a.widget("baosight.bxcomboboxtree",a.baosight.bxtree,{options:{defalutValue:""},_create:function(){var b=this.element,c=b.attr("id")+"_input";0==a("#"+c).length&&(a('<input id="'+c+'" name="'+c+'" type="text" style="width:100%;height:25px"> </input> ').appendTo(a(this.element)),a('<input id="save_'+c+'" name="save_'+c+'" type="hidden"> </input> ').appendTo(a(this.element)));var d=a('<div id="'+b.attr("id")+'_bxtree_around" style="display:none">');a('<div style="position: absolute"><i class="fa fa-search" style="position: absolute;left: 5px;top: 3px;"></i></div><input id="'+b.attr("id")+'_search_input" placeholder="搜索关键字" style="width:100%;padding-left:20px;border-bottom:1px solid #D5D5D5"/>').appendTo(d),a('<div id="'+b.attr("id")+'_bxtree_div"></div>').appendTo(d),a(b).after(d),console.log("bxcomboboxtree widget create")},_init:function(){this._superApply(arguments),console.log("bxcomboboxtree widget init"),a("#"+this.element.attr("id")+"_bxtree_div").jstree("destroy"),"local"===this.options.dataPattern?this.loadCustomData():this.queryccs()},loadCustomData:function(){var b=this.element.attr("id");this.loadCustomDatawithObj(a("#"+b+"_bxtree_div"))},loadOption:function(b){var c=this.element.attr("id");this.loadOptionwithObj(b,a("#"+c+"_bxtree_div"))},queryccs:function(){var b=this.element.attr("id");this.queryccswithObj(a("#"+b+"_bxtree_div"))},loadOptionwithObj:function(a,c){var d=this.element.attr("id");void 0!=this.options.preHandlerFunct&&null!=this.options.preHandlerFunct&&this.options.preHandlerFunct(a),c.jstree(a).bind("loaded.jstree",function(a,b){b.instance.open_all(-1)});for(var e in this.options.bind){var f=e+".jstree";c.on(f,this.options.bind[e])}void 0!=this.options.callBackFunct&&null!=this.options.callBackFunct&&this.options.callBackFunct(),b.bindJstree({render:d+"_bxtree_div",showField:d,saveField:d+"_input",picker:d+"_bxtree_around",searchField:d+"_search_input",width:"100%",height:200})},destroy:function(){console.log("bxcomboboxtree widget destroy"),this._superApply(arguments)},_setOption:function(a,b){console.log("_setOption: key=%s  value=%s",a,b),this._superApply(arguments)},_setOptions:function(a){var b;for(b in a)this._setOption(b,a[b]);return this},rawObj:function(){return a("#"+this.element.attr("id")+"_input")},getValue:function(){return a("#"+this.element.attr("id")+"_input").val()}});var b={bindJstree:function(c){var d=a("#"+c.picker);d.addClass("apm-tree-picker"),d.css("width",c.width),d.css("max-height",c.height);var e=a("#"+c.showField),f=e.offset().top+e.outerHeight(),g=e.offset().left;d.css("top",f),d.css("left",g),d.css("overflow","auto"),d.css("border","1px solid #D5D5D5");var h=a("#"+c.render);h.css("text-align","left");var i=e.find("i"),j=e.find("input"),k=a("#"+c.saveField);if(c.searchField&&a("#"+c.searchField)){var l=a("#"+c.searchField),m=!1;l.keyup(function(){m&&clearTimeout(m),m=setTimeout(function(){var a=l.val();h.jstree(!0).search(a)},250)})}h.on("changed.jstree",function(b,d){if(d&&d.selected.length>0){a("#"+c.saveField).val(d.selected.join(","));var e,f,g=[];for(e=0,f=d.selected.length;f>e;e++)g.push(d.instance.get_node(d.selected[e]).text);i.show(),j.val(g.join(","))}else i.hide(),j.val(""),k.val("")}),h.on("loaded.jstree",function(b,d){h.jstree("open_all");var e=a("#"+c.saveField).val(),f=e.split(",");if(!e||!f||0===f.length)return void i.hide();var g=[];h.find("li").each(function(){for(var b=0;b<f.length;b++)if(a(this).attr("id")==f[b]){g.push(d.instance.get_node(f[b]).text),h.jstree("select_node",a(this));break}}),i.show(),j.val(g.join(","))}),e.on("click",function(){d.show()}),a("body").click(function(b){0==a(b.target).parents("#"+c.showField).length&&0==a(b.target).parents("#"+c.picker).length&&b.target.id!=c.showField&&b.target.id!=c.picker&&-1==b.target.className.indexOf("jstree")&&d.hide()}),i.on("click",function(){b.deselectJstree(c),i.hide()})},deselectJstree:function(b){var c=a("#"+b.render),d=a("#"+b.saveField),e=d.val().split(",");e&&0!==e.length&&(c.find("li").each(function(){for(var b=0;b<e.length;b++)if(a(this).attr("id")==e[b]){c.jstree("deselect_node",a(this));break}}),saveInput.val(""))}}});